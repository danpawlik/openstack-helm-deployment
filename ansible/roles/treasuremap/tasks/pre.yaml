---
- name: Change sudoers
  hosts:
    - k8s_contr
  gather_facts: False
  remote_user: ubuntu
  become: True
  vars:
    ansible_host_key_checking: false
  tasks:
    - name: Clone treasuremap repo
      shell: |
        git clone https://opendev.org/airship/treasuremap.git /home/ubuntu/treasuremap >> /home/ubuntu/logs 2>&1
      ignore_errors: true
      delegate_to: "{{ item }}"
      delegate_facts: True
      loop: "{{ groups['k8s_contr'] }}"

    - name: 000-install-packages.sh
      shell: |
        cd /home/ubuntu/treasuremap && \
         ./tools/deployment/airskiff/developer/000-install-packages.sh >> /home/ubuntu/logs 2>&1
      ignore_errors: true
      run_once: True

    - name: 005-clone-dependencies.sh
      shell: |
        cd /home/ubuntu/treasuremap && \
         ./tools/deployment/airskiff/developer/005-clone-dependencies.sh >> /home/ubuntu/logs 2>&1
      ignore_errors: true
      run_once: true
