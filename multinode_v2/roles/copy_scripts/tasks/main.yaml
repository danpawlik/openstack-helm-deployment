---
- name: Prepare hosts
  hosts:
    - k8s_contr
    - k8s_minion
  serial:
    - "100%"
  gather_facts: False
  remote_user: ubuntu
  become: True
  vars:
    ansible_host_key_checking: false
  tasks:
    - name: "Copy controller script"
      copy:
        src: /home/ubuntu/openstack-helm-deployment/multinode_v2/scripts/setup-controller.sh
        dest: /home/ubuntu/
        mode: 0755
        group: ubuntu
        owner: ubuntu
      delegate_to: "{{ item }}"
      delegate_facts: True
      loop: "{{ groups['k8s_contr'] }}"

    - name: "Copy controller script"
      copy:
        src: /home/ubuntu/openstack-helm-deployment/multinode_v2/scripts/clone-osh-repo.sh
        dest: /home/ubuntu/
        mode: 0755
        group: ubuntu
        owner: ubuntu
      delegate_to: "{{ item }}"
      delegate_facts: True
      loop: "{{ groups['k8s_contr'] }}"

    - name: "Copy minion script"
      copy:
        src: /home/ubuntu/openstack-helm-deployment/multinode_v2/scripts/setup-new-host.sh
        dest: /home/ubuntu/
        mode: 0755
        group: ubuntu
        owner: ubuntu
      delegate_to: "{{ item }}"
      delegate_facts: True
      loop: "{{ groups['k8s_minion'] }}"

    - name: "Copy controller script"
      copy:
        src: /home/ubuntu/openstack-helm-deployment/multinode_v2/scripts/upgrade-host.sh
        dest: /home/ubuntu/
        mode: 0755
        group: ubuntu
        owner: ubuntu

    - name: "Copy get pods script"
      copy:
        src: /home/ubuntu/openstack-helm-deployment/multinode_v2/scripts/get-pods.sh
        dest: /home/ubuntu/
        mode: 0755
        group: ubuntu
        owner: ubuntu
      delegate_to: "{{ item }}"
      delegate_facts: True
      loop: "{{ groups['k8s_contr'] }}"
